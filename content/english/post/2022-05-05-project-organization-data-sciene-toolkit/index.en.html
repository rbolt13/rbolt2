---
title: Project Organization - Data Sciene Toolkit
author: Randi Bolt
date: '2022-05-05'
slug: []
categories:
  - undergrad
tags: []
---



<p>These are my notes on Project Organization from <a href="https://benkeser.github.io/info550/">Data Science Toolkit</a>, by David Benkeser.</p>
<p><a href="https://benkeser.github.io/info550/recordings/project-organization">Video</a> | <a href="https://benkeser.github.io/info550/lectures/08_organization/organization.html#1">Notes</a> | <a href="https://github.com/benkeser/info550">Github</a></p>
<div id="part-1-000---3654" class="section level1">
<h1>Part 1 (0:00 - 36:54)</h1>
<div id="pre-lecture-questions" class="section level2">
<h2>Pre-lecture Questions</h2>
<div id="how-to-add-headings" class="section level3">
<h3>How to add headings?</h3>
<p>In R chunk use code options : <code>fig.cap="**Figure Caption**"</code></p>
<pre class="r"><code>barplot(c(1,2,3,4))</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-1"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-1-1.png" alt="**Figure Caption**" width="672" />
<p class="caption">
Figure 1: <strong>Figure Caption</strong>
</p>
</div>
<p>Another option would be to have the first row of your table be your title and then format so the first row doesn’t have any line filler in it.</p>
<p><a href="https://stackoverflow.com/questions/33710240/how-to-attach-a-title-to-a-data-frame-in-r">Stackoverflow</a></p>
<pre class="r"><code>report &lt;- list()
report[[1]] &lt;- &quot;Report Name&quot;
report[[2]] &lt;- head(mtcars)
report</code></pre>
<pre><code>## [[1]]
## [1] &quot;Report Name&quot;
## 
## [[2]]
##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<p>Your goal is to minimize time as much as possible.</p>
<p>Don’t spend a lot of time formatting your tables until they are going to be final.</p>
</div>
<div id="what-is-in-r" class="section level3">
<h3>What is <code>::</code> in R?</h3>
<p>A better way of referencing functions from a particular package.</p>
<p>For example: <code>bookdown::htmldoc2</code> means that in that in the bookdown package there is a function htmldoc2. That way if multiple functions from different packages have the same name, now your code knows which package to call it from.</p>
<p>This is less ambiguous.</p>
</div>
</div>
</div>
<div id="lecture" class="section level1">
<h1>Lecture</h1>
<div id="basic-principles" class="section level2">
<h2>Basic Principles</h2>
<div id="use-git" class="section level3">
<h3>Use git</h3>
<ul>
<li><p><span style="color: red;"><strong>Put everything in one version-controlled directory.</strong></span></p></li>
<li><p>Jenny Bryan talks about <a href="https://rstats.wtf/project-oriented-workflow.html">Project Oriented Workflow</a></p>
<p><a href="https://jennybryan.org/">Website</a> | <a href="https://twitter.com/JennyBryan?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">Twitter</a> | <a href="https://github.com/jennybc">GitHub</a></p></li>
<li><p>Everything related to one project lives in one folder on you computer.</p></li>
<li><p>Don’t spread things out across multiple folders.</p></li>
<li><p>Put project directory on version control, and that’s going to be your git repository.</p></li>
</ul>
</div>
<div id="develop-your-own-system" class="section level3">
<h3>Develop your own system</h3>
<ul>
<li>Be Consistent, but look for ways to improve.
<ul>
<li>Naming conventions, file structure, make strucure</li>
</ul></li>
</ul>
</div>
<div id="data" class="section level3">
<h3>Data</h3>
<ul>
<li>Raw data is sacred and kept seperate from everything else.</li>
<li>Separate code and data</li>
<li>Use make files and/ or READMEs to document dependencies</li>
</ul>
</div>
<div id="names" class="section level3">
<h3>Names</h3>
<ul>
<li>No spaces in file names</li>
<li>use meaningful file names</li>
<li>use YY-MM-DD date formatting
<ul>
<li>this sorts you data (ex: most recent)properly</li>
</ul></li>
</ul>
</div>
<div id="code" class="section level3">
<h3>Code</h3>
<ul>
<li>Modularize R code.</li>
<li>Know where to go to make changes.</li>
<li><span style="color: red;"><strong>No absolute paths.</strong></span></li>
<li><span style="color: red;"><strong>Use a package management system</strong></span></li>
</ul>
</div>
</div>
<div id="what-to-organize" class="section level2">
<h2>What to organize?</h2>
<p>It is probably useful to have a system for organizing:</p>
<ul>
<li>data analysis projects;</li>
<li>first-author papers;</li>
<li>talks.</li>
</ul>
<p><span style="color: red;"><strong>Think about organization of a project from the outset!</strong></span></p>
</div>
<div id="collaborative-projects" class="section level2">
<h2>Collaborative Projects</h2>
<ul>
<li>Google drive</li>
<li><a href="https://www.overleaf.com/">Overleaf</a></li>
</ul>
<p>Some advice:</p>
<ul>
<li>Address organization from the outset.</li>
<li>Ideally, bring people on board to your (version controlled, reproducible) system.</li>
<li>Keep open lines of communication (especially if using GitHub)</li>
</ul>
<p>Even if some elements of the project are outside your control, you can try to bring in elements to your workflow.</p>
<ul>
<li>E.g., if you receive comments with tracked changes from a colleague, incorporate them into the document, add a commit message describing who’s edits they were.</li>
</ul>
<p>If working on a shared GitHub repo, keep open lines of communication, e.g., short emails (or <a href="https://slack.com/">slack</a> messages, etc…), “Just pushed <code>x</code>…”</p>
<p><img src="img/ExDataAnalysisProject.png" /></p>
<ul>
<li>raw data is sacred</li>
<li>clean data will be saved into the data folder</li>
<li>serperate scripts out by language or have a code directory</li>
<li>numbering equations will give an indicator in what order the code runs.</li>
<li>sandbox directory for exploratory data analysis that no one really needs to see.</li>
<li>Makefile</li>
<li>renv is a way to manage R package</li>
</ul>
<p>Note: To go back two levels in your file directory: <code>./../../</code></p>
</div>
<div id="organizing-data" class="section level2">
<h2>Organizing Data</h2>
<ul>
<li>Dont be tempted to edit raw data by hand</li>
<li>Everything scripted</li>
<li>Let collaborators know: “Don’t color code things.”</li>
<li>Ask for a moc data set ahead of time so you know their form ahead of time to talk about raw data formatting ahead of time.</li>
</ul>
<p>Use meta-data files to describe raw and cleaned data.</p>
<ul>
<li>structure as data (e.g. .csv so easy to read)</li>
</ul>
<p><a href="https://www.jstatsoft.org/article/view/v059i10">Tidy Data by Hadley Wickham</a></p>
<ul>
<li>Worth the read</li>
<li>Each Varibale forms a column</li>
<li>Each observation forms a row</li>
<li>Each observation unit forms a table.</li>
</ul>
</div>
<div id="exploring-data" class="section level2">
<h2>Exploring data</h2>
<p>One of the first things we’ll often do is open the data and start poking around.</p>
<ul>
<li>Could be informal, “getting to know you.”</li>
<li>Could be more formal, “see if anything looks interesting.”</li>
</ul>
<p>This is often done in an ad-hoc way:</p>
<ul>
<li>entering commands directly into R;</li>
<li>making and saving plots “by hand”;</li>
<li>etc…</li>
</ul>
<p><strong>Slow down and document</strong></p>
<ul>
<li>Your future self will thank you</li>
<li>even if it is just in a google doc to yourself.</li>
</ul>
<p>You want to avoid situations like:</p>
<ul>
<li>need to recreate a plot that you made “by hand” and saved “by hand”;</li>
<li>figuring out why you removed certain observations;</li>
<li>trying to remember what variables had an interesting relationship that you wanted to follow up on later.</li>
</ul>
<p>Write out a set of comments describing what you are try to accomplish and fill in code from there.</p>
<ul>
<li>I do this for every coding project.
<ul>
<li>Data analysis, methods coding, package development</li>
</ul></li>
</ul>
<p>Leave a search-able comment tag by code to return to later</p>
<ul>
<li>I use e.g., <code># TO DO: add math expression to labels; make colors prettier</code>.</li>
</ul>
<p>Sets “the bones” of a formal analysis in place while allowing for some creative flow.</p>
<p>From the outset, stop and think about what you want to do. Start filling in details from there. That simple approach will increase efficiency and reproducibility.</p>
<p>Other helpful ideas for formalizing exploratory data analysis:</p>
<ul>
<li><code>.Rhistory</code> files
<ul>
<li>all the commands used in an R session</li>
</ul></li>
<li>Informal <code>.Rmd</code> documents.
<ul>
<li>easy way to organize code/comments into readable format</li>
</ul></li>
<li><code>save</code> intermediate objects and workspaces
<ul>
<li>and document what they contain!</li>
</ul></li>
<li><code>knitr::spin</code>
<ul>
<li>writing <code>.R</code> scripts with rendered-able comments</li>
</ul></li>
<li><a href="https://jupyter.org/">Juypyter Notebook</a></li>
</ul>
<div id="the-here-package" class="section level3">
<h3>The here package</h3>
<p><strong>No absolute paths</strong></p>
<ul>
<li>Absolute paths are the enemy of project reproducibility.</li>
</ul>
<p>For <code>R</code> projects, the <a href="https://here.r-lib.org/"><code>here</code></a> package provides a simple way to use relative file paths.</p>
<ul>
<li>Read <a href="https://rstats.wtf/project-oriented-workflow.html">Jenny Bryan and James Hester’s chapter</a> on project-oriented work-flows.</li>
</ul>
<p>The use of <code>here</code> is dead-simple and best illustrated by example.</p>
<p><img src="img/The_here_package.png" /></p>
<p>Root directory is <code>my_project</code></p>
<ul>
<li>this is where <code>.git</code> lives</li>
<li>all file paths should be relative to this</li>
</ul>
<p>Each <code>R</code> script or <code>Rmd</code> report, should contain a call to <code>here::i_am('path/to/this/file')</code> at the top</p>
<ul>
<li><code>here::i_am</code> means use function <code>i_am</code> from <code>here</code></li>
</ul>
<p>For example:</p>
<pre class="r"><code># include at the top of script
here::i_am(&#39;R/my_analysis.R&#39;)</code></pre>
<pre><code>## here() starts at /Users/randi/Desktop/2022/rbolt2/content/english/post/2022-05-05-project-organization-data-sciene-toolkit</code></pre>
<pre class="r"><code># now add all your R code </code></pre>
<p>Now anytime you make analysis you can use the here function.</p>
<pre class="r"><code># include at the top of script
here::i_am(&#39;index.en.Rmd&#39;)</code></pre>
<pre><code>## here() starts at /Users/randi/Desktop/2022/rbolt2/content/english/post/2022-05-05-project-organization-data-sciene-toolkit</code></pre>
<pre class="r"><code># load data 
my_data &lt;- read.csv(here::here(&#39;data&#39;,&#39;my_data.csv&#39;))

# do some analysis to get results
my_results &lt;- sum(my_data)

# save results
save(my_results, file = here::here(&#39;output&#39;, &#39;my_results.RData&#39;))</code></pre>
</div>
</div>
</div>
<div id="part-2-3940---13120" class="section level1">
<h1>Part 2 (39:40 - 1:31:20)</h1>
<p>Open Example Project in <a href="https://www.sublimetext.com/">Sublime</a></p>
<div id="example-code" class="section level2">
<h2>Example Code</h2>
<p>To begin look at the <code>Makefile</code></p>
<p><img src="img/Makefile_img.png" /></p>
<p>The analysis here is going to culminate in a <span style="color: green;">report</span>, so we have a rule to make a <span style="color: green;">report</span> which says to render the report.Rmd document that lives in the Rmd folder.</p>
<p>We can see the rule for making our report has a prerequisite. It depends on the source code (rmd shown below) and the barchart.png figure in fig folder.</p>
<p>The rule for making that chart is shown on line 4: <span style="color: green;">figs/barchart.png</span>, which depends on the barchart.R code in the R directory.</p>
<p><img src="img/report_img.png" /></p>
<p>This report is saying that we looked at some data and make a figure which lives in the “figs” folder and is called “barchart.png”.</p>
<p><img src="img/barchartR_img.png" /></p>
<p>This is making a barchart out of the mtcars data.</p>
<p>In the terminal now run <code>make report</code>, then open the report by typing <code>open Rmd/report.html</code>.</p>
</div>
<div id="here-package-two-examples" class="section level2">
<h2>Here package (Two examples)</h2>
<p>Identity where the folder is in relation to the project root.</p>
<p>In the R folder create an R file <code>test.R</code> with the following in code:</p>
<p><img src="img/testR_img.png" /></p>
<p>Then in the terminal:</p>
<ul>
<li><code>Rscript R/test.R</code></li>
</ul>
<center>
should return the absolute path
</center>
<p>In <code>test.R</code> change line 3 from <code>here::here()</code> to <code>here::here("figs")</code>, save, and run:</p>
<ul>
<li><code>Rscript R/test.R</code></li>
</ul>
<center>
should return the absolute path of the “figs” folder
</center>
<p><strong>Example 2</strong></p>
<p>In the terminal&lt;</p>
<ul>
<li><code>cd R</code></li>
</ul>
<center>
change to R directory
</center>
<ul>
<li><code>ls</code></li>
</ul>
<center>
lists all files in current directory
</center>
<p>Verify this is correct.</p>
<ul>
<li><code>mkdir R_subdir</code></li>
</ul>
<center>
create a new directory called “R_subdir”
</center>
<p>Now create an R file similar to the previous example and play around with the here function. Then remove the files that were just added:</p>
<ul>
<li><p><code>rm -rf R/R_subdir/</code></p></li>
<li><p><code>rm R/test.R</code></p></li>
<li><p><code>rm figs/barchart.png</code></p></li>
</ul>
</div>
<div id="package-management-system-renv" class="section level2">
<h2>Package management system : `renv``</h2>
<p>We want to record not only what packages we are using but:</p>
<ul>
<li>which versions of those packages we are using</li>
<li>Where we downloaded those packages from</li>
<li>what version of R we are using</li>
</ul>
<p>In example_project identify the projects that we need:</p>
<ol style="list-style-type: decimal">
<li>here</li>
<li>wesanderson</li>
<li>knitr</li>
<li>rmarkdown</li>
</ol>
<p>In the terminal,</p>
<ul>
<li><code>pwd</code></li>
</ul>
<center>
confirm where you are
</center>
<ul>
<li><code>R</code></li>
</ul>
<center>
open R
</center>
<p>This will also return what version of R we are working in.</p>
<ul>
<li><code>renv::init()</code></li>
</ul>
<p>Note: renv needs to already be installed in R.</p>
<p>A list should be returned that shows the packages we are using, and the packages those packages depend on. Then it is saving all of that information into a lockfile which is now saved into the project file.</p>
<p>Notice that other files appeared as well, such as “.Rprofile” which is a single line that says one line: ‘source(“renv/activate.R”)’. When you open R the software is looking for these .Rprofile files (similar to bash or zshell). Be careful messing with this file, because that creates issues with reproducibility.</p>
<p>The line `(“renv/activate.R”)’ is making R aware that we are in a project directory and there is a package library that’s associated with that package directory.</p>
<p>We also now have an “renv” folder which contains activate scripts, and takes all of the specific versions of packages and places them into the project library. Note that it wont actually put those files into the folder, but will search your computer for that version of the package and link to that. That way you don’t have a lot of duplicate packages on your computer.</p>
<p>In the terminal:</p>
<ul>
<li><code>q()</code></li>
</ul>
<center>
close R
</center>
<ul>
<li>R</li>
</ul>
<center>
start R
</center>
<p>Notice there is a different output, which recognizes our package environment. If you get errors loading packages then type the following into the terminal:</p>
<ul>
<li><code>renv::restore()</code></li>
</ul>
<center>
install packages on your computer
</center>
<p>Now look back at the rmd file <code>report.Rmd</code> at lines 8 and 9, shown below.</p>
<p><img src="img/report_img.png" /></p>
<ol start="8" style="list-style-type: decimal">
<li><p>Recognizes where this file is in relation to the project directory.</p></li>
<li><p>This is saying anytime you find R code in this rmd script, run it from the project directly (which is where the code needs to be run from to make it aware of renv and packages needed).</p></li>
</ol>
<p>Moral of the story is to copy these two lines of code at the top of all of our rmd.</p>
</div>
</div>
<div id="part-3-12120---20549" class="section level1">
<h1>Part 3 (1:21:20 - 2:05:49)</h1>
<p>What does a collaborative workflow look like?</p>
<div id="colaborating-with-renv" class="section level2">
<h2>Colaborating with renv</h2>
<p>User A initializes the lockfile using <code>renv::init()</code>.</p>
<p>User A commits the following to github:</p>
<ul>
<li>renv.lock</li>
<li>.Rprofile</li>
<li>renv/activate.R</li>
</ul>
<p>User B clones and downloads repo, and uses <code>renv::restore()</code> to synchronize their local project directory.</p>
<p>User B adds new packages to code, uses <code>renv::snapshot()</code> to record changes to <code>renv.lock</code></p>
<p>User B commits <code>renv.lock</code> and pushes to GitHub.</p>
<p>User A pulls from GitHub, opens <code>R</code>, and uses <code>renv::restore()</code> to synchronize their local project directory.</p>
</div>
<div id="breakout-exercise" class="section level2">
<h2>Breakout Exercise</h2>
<p>In the terminal:</p>
<ul>
<li><code>q()</code></li>
</ul>
<center>
quit what you are working in
</center>
<ul>
<li><code>pwd</code></li>
</ul>
<center>
print working directory
</center>
<p>Verify you are in the correct example_project directory</p>
<ul>
<li><code>git init</code></li>
</ul>
<center>
create a new Git repository
</center>
<p>Verify a git folder has been added.</p>
<p>Now create a github repository for example project, and copy the line of code that looks like the following into the terminal:</p>
<ul>
<li><code>git remote add origin https://github.com/user_name/example_project.git</code></li>
</ul>
<p>Note: you might have issues if your github isn’t cached.</p>
<p>For the first Commit:</p>
<ul>
<li><code>git status</code></li>
</ul>
<center>
display status of working directory
</center>
<ul>
<li><code>git add *</code></li>
</ul>
<center>
add all files that don’t begin with a <code>.</code>
</center>
<ul>
<li><code>git status</code></li>
</ul>
<center>
display status of working directory
</center>
<p>Verify everything was added, otherwise:</p>
<ul>
<li><code>git add .thing1 .thing2 .thing3</code></li>
</ul>
<center>
add files that begin with <code>.</code>
</center>
<ul>
<li><code>git status</code></li>
</ul>
<center>
display status of working directory
</center>
<p>Verify everything was added.</p>
<ul>
<li><p><code>git commit -m "my first commit"</code></p></li>
<li><p><code>git push origin master</code></p></li>
</ul>
<p>Verify github was updated.</p>
<p>User B then forks the repository to make a copy of it onto their computer. Cope a similar line of code shown below into the terminal:</p>
<ul>
<li><p><code>git clone https://github.com/user_name/example_project.git</code></p></li>
<li><p><code>cd example_project</code></p></li>
<li><p><code>R</code></p></li>
</ul>
<center>
Open R
</center>
<ul>
<li><p><code>renv::restore()</code></p></li>
<li><p><code>q()</code></p></li>
</ul>
<center>
Close R
</center>
<ul>
<li><p><code>make report</code></p></li>
<li><p><code>open Rmd/report.html</code></p></li>
</ul>
<p>Verify report runs.</p>
<ul>
<li><code>R</code></li>
</ul>
<center>
Open R
</center>
<ul>
<li>renv::remove(‘wesanderson’)</li>
</ul>
<center>
remove wes anderson package
</center>
<p>Then open the barchart.R file to change following two lines of code:</p>
<p><img src="img/barchart_colors.png" /></p>
<p>Save.</p>
<ul>
<li><code>renv::snapshot()</code></li>
</ul>
<p>This will return the following:</p>
<p><img src="img/renv_snapshot_img.png" /></p>
<ul>
<li><code>y</code></li>
</ul>
<p>You will now have a new lockfile.</p>
<ul>
<li><code>git diff</code></li>
</ul>
<center>
check the changes that were made
</center>
<ul>
<li><code>q()</code></li>
</ul>
<center>
quit R
</center>
<p>Then commit.</p>
<p>User A can then try these changes out in an isolated enviromnt.</p>
<ul>
<li><code>git remote add userb https://github.com/user_b/example_project.git</code></li>
</ul>
<center>
link to user b’s repository
</center>
<ul>
<li><code>git fetch user_b master</code></li>
</ul>
<center>
fetch user_b’s main branch
</center>
<p><code>git checkout remotes/user_b/master</code></p>
<center>
checkout user_b’s main branch
</center>
<p>Verify changes.</p>
<ul>
<li><p><code>git checkout -b user_b</code></p></li>
<li><p><code>git merge user_b</code></p></li>
</ul>
<center>
merge user_b’s branch into master
</center>
<ul>
<li><code>git push</code></li>
</ul>
<p>Now user A wants to change the colors again.</p>
<ul>
<li><p><code>R</code></p></li>
<li><p><code>renv::remove("RColorBrewer")</code></p></li>
<li><p><code>q()</code></p></li>
</ul>
<p>Then update the barchart.R file by removing lines 4 and 5, then replacing them with:</p>
<p><img src="img/barchartR_colors2.png" /></p>
<p>Save, then in the terminal:</p>
<ul>
<li><p>make report</p></li>
<li><p>open Rmd/report.html</p></li>
</ul>
<p>Verify report looks good.</p>
<ul>
<li><p>git status</p></li>
<li><p>git add <code>*</code></p></li>
<li><p>git status</p></li>
<li><p>git add (anything that was missed)</p></li>
<li><p>git status</p></li>
<li><p>git commit -m “Removed RColorBrewer and changed colors to baseR.”</p></li>
<li><p>git push origin master</p></li>
</ul>
<p>B’s then copies the updated repository, and in the terminal:</p>
<ul>
<li>git remote add user_a git config advice.addIgnoredFile false</li>
</ul>
<center>
(creates path to user A github repository)
</center>
<ul>
<li><p>git fetch user_a master</p></li>
<li><p>git checkout remotes/user_a/master</p></li>
<li><p>R()</p></li>
<li><p>renv::status()</p></li>
<li><p>q()</p></li>
<li><p>make report</p></li>
<li><p>open Rmd/report.html</p></li>
</ul>
<p>Verify colors are baseR.</p>
<ul>
<li><p>git checkout -b user_a</p></li>
<li><p>git checkout master</p></li>
<li><p>git merge user_a</p></li>
<li><p>git push origin master</p></li>
</ul>
<p>The end ~</p>
<div id="questions" class="section level3">
<h3>Questions</h3>
<p>Q: Do we have to go between bash and R and bash again to touch do anything with env?</p>
<p>A: Yes, but we can also do something else …</p>
<p>In make file add the following lines of code:</p>
<p><img src="img/update_makefile_img.png" /></p>
<p>this will automate that entire process for us.</p>
<p>Now in terminal we can type: <code>make restore</code> which will cut out the middle man which avoids the need to open an R session every time.</p>
<p>Note: My completed replication of this example_project can be found <a href="https://github.com/rbolt13/example_project">here</a>.</p>
</div>
</div>
</div>
